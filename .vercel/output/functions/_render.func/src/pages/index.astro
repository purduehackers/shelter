---
import Layout from "../layouts/Layout.astro";
import ProjectCard from "../components/ProjectCard.astro";
import type { ShelterProject, PayloadResponse } from "../types/shelter";

const CMS_URL = "https://cms.purduehackers.com";

let projects: ShelterProject[] = [];
let error: string | null = null;
let projectHomeText: string = "Loading...";

try {
    const response = await fetch(`${CMS_URL}/api/shelter-projects?depth=1`);
    if (!response.ok) {
        throw new Error(`Failed to fetch projects: ${response.status}`);
    }
    const data: PayloadResponse<ShelterProject> = await response.json();
    projects = data.docs;
    projectHomeText =
        projects.length > 1
            ? `${projects.length} Projects Need Homes!`
            : `1 Project Needs a Home!`;
} catch (e) {
    error = e instanceof Error ? e.message : "Failed to load projects";
    console.error("Error fetching projects:", e);
}
---

<Layout title="Project Shelter - Find Your Next Project">
    <!-- Corkboard background -->
    <div class="min-h-screen bg-amber-700 relative">
        <!-- Cork texture layers -->
        <div class="absolute inset-0 cork-texture"></div>
        <div
            class="absolute inset-0 opacity-40 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIj4KPGZpbHRlciBpZD0ibm9pc2UiPgo8ZmVUdXJidWxlbmNlIHR5cGU9ImZyYWN0YWxOb2lzZSIgYmFzZUZyZXF1ZW5jeT0iMC44IiBudW1PY3RhdmVzPSI0IiBzdGl0Y2hUaWxlcz0ic3RpdGNoIi8+CjwvZmlsdGVyPgo8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsdGVyPSJ1cmwoI25vaXNlKSIgb3BhY2l0eT0iMC41Ii8+Cjwvc3ZnPg==')]"
        >
        </div>
        <div
            class="absolute inset-0 opacity-20 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCI+CjxyZWN0IHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgZmlsbD0iI2Q0YTU3NCI+PC9yZWN0Pgo8Y2lyY2xlIGN4PSIzMCIgY3k9IjMwIiByPSIyMCIgZmlsbD0iI2M5OWE2OSIgb3BhY2l0eT0iMC41Ij48L2NpcmNsZT4KPGNpcmNsZSBjeD0iMTAiIGN5PSIxMCIgcj0iOCIgZmlsbD0iI2JlOGY1ZSIgb3BhY2l0eT0iMC4zIj48L2NpcmNsZT4KPGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iMTIiIGZpbGw9IiNkOWFhNzkiIG9wYWNpdHk9IjAuNCI+PC9jaXJjbGU+Cjwvc3ZnPg==')]"
        >
        </div>
        <!-- Speckle overlay -->
        <div
            class="absolute inset-0 opacity-30 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj4KPGNpcmNsZSBjeD0iMTAiIGN5PSIxNSIgcj0iMiIgZmlsbD0iIzhhNjM0MiIgb3BhY2l0eT0iMC40Ii8+CjxjaXJjbGUgY3g9IjUwIiBjeT0iMzAiIHI9IjEuNSIgZmlsbD0iI2E4N2M1MCIgb3BhY2l0eT0iMC4zIi8+CjxjaXJjbGUgY3g9IjkwIiBjeT0iMjAiIHI9IjIuNSIgZmlsbD0iIzZkNGMyOCIgb3BhY2l0eT0iMC41Ii8+CjxjaXJjbGUgY3g9IjEzMCIgY3k9IjQ1IiByPSIxLjgiIGZpbGw9IiM5YTZiM2UiIG9wYWNpdHk9IjAuNCIvPgo8Y2lyY2xlIGN4PSIxNzAiIGN5PSIyNSIgcj0iMiIgZmlsbD0iIzdiNTMzMCIgb3BhY2l0eT0iMC4zNSIvPgo8Y2lyY2xlIGN4PSIyNSIgY3k9IjcwIiByPSIyLjIiIGZpbGw9IiNhNTc4NGEiIG9wYWNpdHk9IjAuNDUiLz4KPGNpcmNsZSBjeD0iNzAiIGN5PSI4NSIgcj0iMS41IiBmaWxsPSIjOGE2MzQyIiBvcGFjaXR5PSIwLjMiLz4KPGNpcmNsZSBjeD0iMTEwIiBjeT0iNzUiIHI9IjIuOCIgZmlsbD0iIzZkNGMyOCIgb3BhY2l0eT0iMC40Ii8+CjxjaXJjbGUgY3g9IjE1MCIgY3k9IjkwIiByPSIxLjgiIGZpbGw9IiM5YTZiM2UiIG9wYWNpdHk9IjAuMzUiLz4KPGNpcmNsZSBjeD0iMTg1IiBjeT0iNjUiIHI9IjIuMiIgZmlsbD0iI2E1Nzg0YSIgb3BhY2l0eT0iMC40NSIvPgo8Y2lyY2xlIGN4PSIzNSIgY3k9IjEyMCIgcj0iMiIgZmlsbD0iIzdiNTMzMCIgb3BhY2l0eT0iMC4zIi8+CjxjaXJjbGUgY3g9IjgwIiBjeT0iMTQwIiByPSIyLjUiIGZpbGw9IiM4YTYzNDIiIG9wYWNpdHk9IjAuNCIvPgo8Y2lyY2xlIGN4PSIxMjUiIGN5PSIxMjUiIHI9IjEuNSIgZmlsbD0iI2E4N2M1MCIgb3BhY2l0eT0iMC4zNSIvPgo8Y2lyY2xlIGN4PSIxNjUiIGN5PSIxNDUiIHI9IjIuMiIgZmlsbD0iIzZkNGMyOCIgb3BhY2l0eT0iMC40NSIvPgo8Y2lyY2xlIGN4PSIxNSIgY3k9IjE3MCIgcj0iMS44IiBmaWxsPSIjOWE2YjNlIiBvcGFjaXR5PSIwLjMiLz4KPGNpcmNsZSBjeD0iNTUiIGN5PSIxODUiIHI9IjIuNSIgZmlsbD0iI2E1Nzg0YSIgb3BhY2l0eT0iMC40Ii8+CjxjaXJjbGUgY3g9Ijk1IiBjeT0iMTY1IiByPSIyIiBmaWxsPSIjN2I1MzMwIiBvcGFjaXR5PSIwLjM1Ii8+CjxjaXJjbGUgY3g9IjE0MCIgY3k9IjE4MCIgcj0iMS41IiBmaWxsPSIjOGE2MzQyIiBvcGFjaXR5PSIwLjQ1Ii8+CjxjaXJjbGUgY3g9IjE4MCIgY3k9IjE3MCIgcj0iMi44IiBmaWxsPSIjNmQ0YzI4IiBvcGFjaXR5PSIwLjMiLz4KPC9zdmc+')]"
        >
        </div>

        <!-- Wood frame border -->
        <div
            class="absolute inset-0 border-[16px] border-amber-950 shadow-inner pointer-events-none"
            style="box-shadow: inset 0 0 30px rgba(0,0,0,0.5), inset 0 0 60px rgba(0,0,0,0.2);"
        >
        </div>

        <!-- Content -->
        <div class="relative z-10 px-8 py-12 md:px-16 md:py-16">
            <!-- Header -->
            <header class="text-center mb-12">
                <h1
                    class="text-5xl md:text-7xl font-handwriting text-white drop-shadow-lg mb-4"
                >
                    Project Shelter
                </h1>
                <p
                    class="text-xl text-amber-100 max-w-2xl mx-auto font-handwriting"
                >
                    These projects are looking for a loving home. Could you be
                    their new maintainer?
                </p>

                <!-- Sticky note -->
                <div
                    class="mt-6 inline-block relative transform rotate-1 hover:rotate-0 transition-transform"
                >
                    <div
                        class="bg-yellow-200 px-6 py-4 shadow-lg relative"
                        style="box-shadow: 2px 3px 8px rgba(0,0,0,0.3);"
                    >
                        <!-- Folded corner effect -->
                        <div
                            class="absolute top-0 right-0 w-0 h-0 border-l-[20px] border-l-yellow-300 border-b-[20px] border-b-transparent"
                        >
                        </div>
                        <span class="font-handwriting text-2xl text-amber-900">
                            {projectHomeText}
                        </span>
                    </div>
                </div>
            </header>

            {
                error ? (
                    <div class="max-w-md mx-auto bg-white/90 p-6 rounded-lg shadow-lg text-center">
                        <p class="text-red-600 font-medium">Oops! {error}</p>
                        <p class="text-gray-600 mt-2">
                            Please try again later.
                        </p>
                    </div>
                ) : projects.length === 0 ? (
                    <div class="max-w-md mx-auto bg-white/90 p-6 rounded-lg shadow-lg text-center">
                        <p class="text-gray-600">
                            All projects have found homes! ðŸŽ‰
                        </p>
                        <p class="text-gray-500 mt-2 text-sm">
                            Check back soon for more projects looking for
                            maintainers.
                        </p>
                    </div>
                ) : (
                    <div class="flex flex-wrap justify-center gap-8 md:gap-12">
                        {projects.map((project) => (
                            <ProjectCard project={project} />
                        ))}
                    </div>
                )
            }

            <!-- Footer note -->
            <footer class="mt-16 text-center">
                <p class="text-amber-200/70 text-sm font-handwriting text-lg">
                    A Purdue Hackers Initiative ðŸ’›
                </p>
            </footer>
        </div>
    </div>
</Layout>

<style>
    .font-handwriting {
        font-family: "Caveat", cursive;
    }
    .cork-texture {
        background:
            radial-gradient(
                ellipse at 20% 30%,
                rgba(180, 120, 60, 0.4) 0%,
                transparent 50%
            ),
            radial-gradient(
                ellipse at 80% 20%,
                rgba(160, 100, 50, 0.3) 0%,
                transparent 40%
            ),
            radial-gradient(
                ellipse at 40% 80%,
                rgba(190, 130, 70, 0.35) 0%,
                transparent 45%
            ),
            radial-gradient(
                ellipse at 70% 60%,
                rgba(150, 95, 45, 0.3) 0%,
                transparent 50%
            ),
            radial-gradient(
                ellipse at 10% 70%,
                rgba(170, 110, 55, 0.25) 0%,
                transparent 35%
            ),
            radial-gradient(
                ellipse at 90% 85%,
                rgba(185, 125, 65, 0.3) 0%,
                transparent 40%
            );
    }
</style>
