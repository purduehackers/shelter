---
import type { ShelterProject } from "../types/shelter";

const CMS_URL = "https://cms.purduehackers.com";

interface Props {
    project: ShelterProject;
}

const { project } = Astro.props;

const imageUrl = project.image.url.startsWith("http")
    ? project.image.url
    : `${CMS_URL}${project.image.url}`;

// Random slight rotation for corkboard effect
const rotations = ["-2deg", "-1deg", "0deg", "1deg", "2deg"];
const randomRotation = rotations[Math.floor(Math.random() * rotations.length)];

// Random pin colors
const pinColors = [
    "bg-red-500",
    "bg-yellow-500",
    "bg-blue-500",
    "bg-green-500",
    "bg-pink-500",
];
const randomPinColor = pinColors[Math.floor(Math.random() * pinColors.length)];
---

<a
    href={`/project/${project.id}`}
    class="group block"
    style={`--rotation: ${randomRotation}`}
>
    <article
        class="relative bg-white p-3 pb-4 shadow-lg transition-all duration-300 ease-out hover:scale-105 hover:shadow-2xl [transform:rotate(var(--rotation))] hover:[transform:rotate(0deg)_translateY(-8px)]"
        style="max-width: 280px;"
    >
        <!-- Push Pin -->
        <div class="absolute -top-3 left-1/2 -translate-x-1/2 z-10">
            <div
                class={`w-6 h-6 rounded-full ${randomPinColor} shadow-md border-2 border-white`}
            >
                <div
                    class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-white/50"
                >
                </div>
            </div>
            <div
                class="absolute top-5 left-1/2 -translate-x-1/2 w-1 h-2 bg-gray-400 rounded-b"
            >
            </div>
        </div>

        <!-- Polaroid-style image -->
        <div class="bg-gray-100 aspect-square overflow-hidden">
            <img
                src={imageUrl}
                alt={project.image.alt || project.name}
                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
                loading="lazy"
            />
        </div>

        <!-- Project Info -->
        <div class="mt-3 text-center">
            <h2 class="font-handwriting text-2xl text-gray-800 leading-tight">
                {project.name}
            </h2>
            <div class="mt-2 space-y-1">
                <p class="text-xs text-gray-500 uppercase tracking-wide">
                    Last seen with
                </p>
                <p class="text-sm font-medium text-gray-700">
                    {project.last_owner}
                </p>
                <p class="text-xs text-gray-500">
                    {project.last_division}
                </p>
            </div>
        </div>

        <!-- "Adopt Me" badge -->
        <div
            class="absolute -bottom-2 -right-2 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-md transform rotate-12 group-hover:rotate-0 group-hover:scale-110 transition-transform"
        >
            Adopt Me!
        </div>

        <!-- Paper texture overlay -->
        <div
            class="absolute inset-0 pointer-events-none opacity-10 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjZmZmIj48L3JlY3Q+CjxyZWN0IHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9IiNjY2MiPjwvcmVjdD4KPC9zdmc+')]"
        >
        </div>
    </article>
</a>

<style>
    .font-handwriting {
        font-family: "Caveat", cursive;
    }
</style>
